window.VIPSHOP=window.VIPSHOP||{};
VIPSHOP.cookie={set:function(name,value,domain,path,hour){var expire=new Date;if(hour){var today=new Date;expire.setTime(today.getTime()+36E5*hour)}document.cookie=name+"="+encodeURIComponent(escape(value))+"; "+(hour?"expires="+expire.toGMTString()+"; ":"")+(path?"path="+path+"; ":"path=/; ")+(domain?"domain="+domain+";":"");return true},get:function(name){var r=new RegExp("(?:^|;+|\\s+)"+name+"=([^;]*)");var m=document.cookie.match(r);return decodeURIComponent(!m?"":m[1])},del:function(name,domain,
path){document.cookie=name+"=; expires=Mon, 26 Jul 1997 05:00:00 GMT; "+(path?"path="+path+"; ":"path=/; ")+(domain?"domain="+domain+";":"")}};if(window.location.search.indexOf("gotype=2")>=0&&Messenger){$.messenger={};$.messenger.obj=new Messenger("login","vip.com"),$.messenger.obj.addTarget(window.parent,"loginDialog");$.messenger.send=function(msg){$.messenger.obj.targets["loginDialog"].send(msg)}}
var resizeIframe=function(){var $frameLayout=$("body").find(".frameLayout");if($.messenger&&$frameLayout.length)$.messenger.send("method=setDialogHeight&args="+$frameLayout.outerHeight())};function clsoseMessenger(){if($.messenger){$.messenger.send("method=closeDialog");return true}return false}function checkEmail(strEmail){var emailReg=/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/;return emailReg.test(strEmail)}function checkPhone(strPhone){var phoneReg=/^1\d{10}$/;return phoneReg.test(strPhone)}
function checkQQ(strQQ){var QQReg=/^[0-9a-zA-Z@\.\-_]+$/;return QQReg.test(strQQ)}
function checkRegisterUserName(name){var result=new Object;result.result=true;if(!name){result.result=false;result.tips="\u8bf7\u8f93\u5165\u767b\u5f55\u540d";return result}if(!checkEmail(name)&&!checkPhone(name)){result.result=false;result.tips="\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\u6216\u90ae\u7bb1";return result}$.ajax({type:"POST",url:ctx+"/register/ajaxCheckRegisterUserName",data:{"loginName":name,"anticache":(new Date).getTime()},async:false,success:function(data){if(typeof data.result!=
"undefined"&&data.result=="haslogin"){if(clsoseMessenger())return false;redirect2Src();return}if(data==0)result.result=true;else if(data==1){result.result=false;result.tips="\u8be5\u7528\u6237\u540d\u5df2\u5b58\u5728"}else if(data==3){result.result=false;result.tips="\u60a8\u8bf7\u6c42\u7684\u592a\u9891\u7e41\u4e86\uff0c\u8bf7\u8fc710\u5206\u949f\u540e\u91cd\u8bd5"}else{result.result=false;result.tips="\u9a8c\u8bc1\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5"}}});return result}
function checkCaptcha(captcha,vipc,type){var result=new Object;result.result=true;if(!captcha||!vipc){result.result=false;result.tips="\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801";return result}$.ajax({url:ctx+"/captcha/ajaxCheckCaptcha",type:"POST",data:{"captcha":captcha,"vipc":vipc,"anticache":formatTime(captcha),"type":type},async:false,success:function(data){if(typeof data.result!="undefined"&&data.result=="haslogin"){if(clsoseMessenger())return false;redirect2Src();return}if(!data.result){result.result=
false;result.tips="\u9a8c\u8bc1\u7801\u6709\u8bef";if(20203==data.errorCode)result.tips="\u9a8c\u8bc1\u7801\u5df2\u8fc7\u671f";var curVipc=data.vipc;if(curVipc!==null&&curVipc!==undefined&&curVipc!=="")result.vipc=curVipc}}});return result}
function formatTime(val){var normalDate=function(min,max){var random=parseInt(Math.random()*(max-min+1)+min);return Math.floor((new Date).getTime()/1E3)*1E3+random};if(!val||val.length==0)return normalDate(992,995);else{var code="";var firstCode=val[0];var isChinese=/[\u4e00-\u9fa5]/;if(isChinese.test(firstCode)){var lastCode=val[val.length-1];code=lastCode.charCodeAt(0).toString(16)}else if(val.length>4)code=val.substring(val.length-4,val.length);else code=val;var sum="";for(var i=0;i<code.length;i++)sum+=
code.charCodeAt(i).toString(10);if(!Number.MAX_SAFE_INTEGER||sum&&sum<=Number.MAX_SAFE_INTEGER)return Math.floor((new Date).getTime()/1E3)*1E3+sum%991;else return normalDate(996,999)}}
function checkPassword(psw){var result=new Object;result.result=true;if(!psw){result.result=false;result.tips="\u8bf7\u8f93\u5165\u5bc6\u7801";return result}if(psw.length<6||psw.length>20){result.result=false;result.tips="\u8bf7\u8f93\u51656-20\u4f4d\u5b57\u6bcd\u548c\u6570\u5b57\u7684\u7ec4\u5408";return result}if(/^[0-9]{6,20}$/.exec(psw)){result.result=false;result.tips="\u8bf7\u4f7f\u7528\u5b57\u6bcd\u548c\u6570\u5b57\u7ec4\u5408";return result}if(/^[a-zA-Z]{6,20}$/.exec(psw)){result.result=false;
result.tips="\u8bf7\u4f7f\u7528\u5b57\u6bcd\u548c\u6570\u5b57\u7ec4\u5408";return result}if(!/^[a-zA-Z0-9]{6,20}$/.exec(psw)){result.result=false;result.tips="\u8bf7\u4f7f\u7528\u5b57\u6bcd\u548c\u6570\u5b57\u7ec4\u5408";return result}return result}
function callb2c(signedApiUrl,isrisk,isBindMobile){var process=function(){if(isrisk)return redirect2Src();if(!isBindMobile)return bindPhoneIfDemand();redirect2Src()};if(signedApiUrl)$.ajax({url:signedApiUrl+"&callback=?",cache:false,crossDomain:true,contentType:"application/json",dataType:"jsonp",success:function(result){if(result.status==1)process();else alert("\u8bf7\u6c42\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u8bd5 ")},error:function(jqXHR,textStatus,errorThrown){process();return}});
else process()}
function risktips(risk_func){if($("#J_risktips")[0])return false;var that=this;that.config={closeFunc:risk_func,$mask:$(".ui-window-mask"),nickname:VIPSHOP.cookie.get("VipRNAME")||"",username:VIPSHOP.cookie.get("login_username"),capsLock:false,timeout:{delay:null},interval:{countdown:null}};that.configReset=function(){that.config.nickname=VIPSHOP.cookie.get("VipRNAME")||"",that.config.$risk=$("#J_risktips");that.config.$mask=$(".ui-window-mask");that.config.$risk_pwd=$(".J_risk_pwd");that.config.$risk_pwd1=
$("#J_risk_pwd1");that.config.$risk_pwd2=$("#J_risk_pwd2");that.config.$show_warn1=$("#J_show_warn1");that.config.$show_warn2=$("#J_show_warn2");that.config.$content=$("#J_risktips_content");that.config.$submit=$("#J_submit_editorpwd");that.config.$success=$("#J_risk_succ");that.config.$fail=$("#J_risk_fail");that.config.$iknow=$("#J_risk_iknow");that.config.$again=$("#J_risk_again");that.config.$second=$(".J_risk_second");that.config.$close=$(".J_risktips_close");that.config.$degree=$("#J_degree");
that.config.$J_L_psw=$("#J_L_psw")};that.ui={init:function(){that.ui.dialogOpen()},dialogOpen:function(){var _mask=that.config.$mask[0]?"":'<div class="ui-window-mask"></div>';$("body").append($(_mask+$("#J_risktips_tpl").html()));that.configReset();that.config.$risk.find(".J_risk_username").html(that.config.nickname);if(window.location.search.indexOf("gotype=2")>=0){that.config.$close.removeClass("f-hidden");that.config.$risk.addClass("z-dialog-small")}var left=($(window).width()-that.config.$risk.width())/
2,top=($(window).height()-that.config.$risk.height())/2;that.config.$risk.css({"left":left,"top":top}).addClass("z-ui-dialog-in");that.config.$mask.show();that.config.$risk_pwd1.parent().placeholder();that.config.$risk_pwd2.parent().placeholder()},dialogClose:function(){that.config.$mask.hide();that.config.$risk.remove();that.config.closeFunc&&that.config.closeFunc()},focuswarn:function(result,iswarn){var red_border_warn="z-ui-form-item-warning";var red_tips_warn="z-ui-tooltips-in";var blue_warn=
"z-ui-tooltips-info";var $elem=result.elem;that.config.$content.find(".z-ui-tooltips-in").removeClass(red_tips_warn);if(!result.result)if(iswarn){$elem.find(".J_err_msg").html(result.tips);$elem.removeClass([blue_warn,red_border_warn].join(" ")).addClass(red_tips_warn)}else{$elem.find(".J_warn_msg").html(result.tips);$elem.removeClass([red_tips_warn,red_border_warn].join(" ")).addClass(blue_warn)}else $elem.removeClass([red_border_warn,red_tips_warn,blue_warn].join(" "))},blurwarn:function(result){var blue_warn=
"z-ui-tooltips-info";var red_border_warn="z-ui-form-item-warning";var red_tips_warn="z-ui-tooltips-in";if(!result.result)result.elem.removeClass([red_tips_warn,blue_warn].join(" ")).addClass(red_border_warn);else result.elem.removeClass([red_tips_warn,blue_warn,red_tips_warn].join(" "))},submitType:function(step){var c_loading="z-ui-btn-loading";var c_disable="ui-btn-disable";that.config.$submit.data("cansubmit",false);if(step==0){that.config.$submit.removeClass(c_loading).addClass(c_disable);that.config.$content.removeClass("f-hidden");
that.config.$fail.addClass("f-hidden")}else if(step==1){that.config.$submit.removeClass(c_loading+" "+c_disable);that.config.$submit.data("cansubmit",true);that.config.$content.removeClass("f-hidden");that.config.$fail.addClass("f-hidden")}else if(step==2)that.config.$submit.addClass(c_loading).removeClass(c_disable);else if(step==3){that.config.$content.addClass("f-hidden");that.config.$success.removeClass("f-hidden")}else if(step==4){that.config.$content.addClass("f-hidden");that.config.$fail.removeClass("f-hidden")}},
degree:function(lv){var _lv=["z-step-0","z-step-1","z-step-2","z-step-3"];var _type=["\u5f31","\u5f31","\u4e2d","\u9ad8"];that.config.$degree.removeClass(_lv.join(" ")).addClass(_lv[lv]);that.config.$degree.find(".u-progess-text").html(_type[lv])}};that.ev={init:function(){that.ui.init();var _init=["focus","blur","press","submit","click"];for(var i=0;i<_init.length;i++)that.ev[_init[i]]()},checkpwd_1:function(iswarn){var letterPattern=/[a-zA-Z]+/,numbericPattern=/[0-9]+/,specialPattern=/[~!@#$%^&*()_+`\-=\[\]\\{}\|;':",\.\/<>\?]/,
illegalPattern=/[^a-zA-Z0-9~!@#$%^&*()_+`\-=\[\]\\{}\|;':",\.\/<>\?]+/,result=new Object,pwd=that.config.$risk_pwd1.val(),iswarn=iswarn||that.config.$risk_pwd1.data("iswarn"),calcCharsCategory=function(pwd){var category=0;if(letterPattern.test(pwd))category++;if(numbericPattern.test(pwd))category++;if(specialPattern.test(pwd))category++;return category};result.elem=that.config.$show_warn1;result.result=false;result.degree=0;if(pwd&&calcCharsCategory(pwd)<=1)result.degree=1;else if(pwd&&calcCharsCategory(pwd)==
2&&pwd.length<6)result.degree=1;else if(pwd&&calcCharsCategory(pwd)==2&&pwd.length>=6&&pwd.length<12)result.degree=2;else if(pwd&&calcCharsCategory(pwd)==2&&pwd.length>=12)result.degree=3;else if(pwd&&calcCharsCategory(pwd)==3&&pwd.length<6)result.degree=1;else if(pwd&&calcCharsCategory(pwd)==3&&pwd.length>=6&&pwd.length<10)result.degree=2;else if(pwd&&calcCharsCategory(pwd)==3&&pwd.length>=10)result.degree=3;if(!pwd&&!iswarn)result.tips="\u5bc6\u7801\u4e3a6-20\u4f4d\u5b57\u7b26\uff0c\u5305\u542b\u5b57\u6bcd\u3001\u6570\u5b57\u548c\u7b26\u53f7\u4e2d\u7684\u4e24\u79cd";
else if(!pwd&&iswarn)result.tips="\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a";else if(pwd.length<6)result.tips="\u5bc6\u7801\u4e0d\u80fd\u5c11\u4e8e6\u4f4d";else if(illegalPattern.test(pwd)){result.degree=1;result.tips="\u5bc6\u7801\u4e2d\u5305\u542b\u975e\u6cd5\u5b57\u7b26"}else if(calcCharsCategory(pwd)<=1)result.tips="\u5bc6\u7801\u9700\u8981\u5305\u542b\u5b57\u6bcd\u3001\u6570\u5b57\u3001\u7b26\u53f7\u4e2d\u81f3\u5c11\u4e24\u79cd";else if(that.config.username==pwd)result.tips="\u5bc6\u7801\u4e0d\u80fd\u4e0e\u767b\u5f55\u540d\u4e00\u81f4";
else if(that.config.$J_L_psw.val()==pwd)result.tips="\u65b0\u5bc6\u7801\u4e0d\u80fd\u4e0e\u65e7\u5bc6\u7801\u4e00\u81f4";else result.result=true;return result},checkpwd_2:function(iswarn){var result=new Object,pwd=that.config.$risk_pwd2.val(),iswarn=iswarn||that.config.$risk_pwd2.data("iswarn"),rc_pwd=that.config.$risk_pwd1.val();result.result=false;result.elem=that.config.$show_warn2;if(!pwd&&!iswarn)result.tips="\u8bf7\u518d\u6b21\u8f93\u5165\u4e0a\u9762\u7684\u5bc6\u7801";else if(!pwd&&iswarn)result.tips=
"\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u4e00\u81f4";else if(pwd&&rc_pwd!=pwd)result.tips="\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u4e00\u81f4\uff0c\u8bf7\u91cd\u8bd5";else if(pwd&&rc_pwd==pwd)result.result=true;return result},cansubmit:function(){if(that.ev.checkpwd_1().result&&that.ev.checkpwd_2().result)return true;return false},delayhide:function(index){that.config.timeout.delay=setTimeout(function(){that.ui.focuswarn({result:true,elem:that.config["$show_warn"+index]})},3E3)},
click:function(){that.config.$iknow.click(function(){that.ui.dialogClose();clearInterval(that.config.interval.countdown)});that.config.$again.click(function(){that.ui.submitType(0);that.config.$risk_pwd1.val("");that.config.$risk_pwd2.val("");that.ui.degree(0);clearInterval(that.config.interval.countdown)});that.config.$close.click(function(){that.ui.dialogClose()})},focus:function(){that.config.$risk_pwd1.focus(function(){var iswarn=that.config.$risk_pwd1.data("iswarn");that.config.$degree.removeClass("f-hidden");
that.ui.focuswarn(that.ev.checkpwd_1(iswarn),iswarn)});that.config.$risk_pwd2.focus(function(){var iswarn=that.config.$risk_pwd2.data("iswarn");that.ui.focuswarn(that.ev.checkpwd_2(iswarn),iswarn)})},blur:function(){that.config.$risk_pwd1.blur(function(){var result=that.ev.checkpwd_1();if(!result.result)that.config.$risk_pwd1.data("iswarn",true);that.ui.blurwarn(result);clearTimeout(that.config.timeout.delay)});that.config.$risk_pwd2.blur(function(){var result=that.ev.checkpwd_2();if(!result.result)that.config.$risk_pwd2.data("iswarn",
true);that.ui.blurwarn(result);clearTimeout(that.config.timeout.delay)})},press:function(){that.config.$risk_pwd.each(function(i,v){(function(i,$elem){var index=i+1;$elem.keypress(function(event){that.config.capsLock=capslock.detect(event);if(that.config.capsLock){that.ui.focuswarn({tips:"\u952e\u76d8\u5927\u5199\u9501\u5b9a\u5df2\u6253\u5f00\uff0c\u8bf7\u6ce8\u610f\u5927\u5c0f\u5199",result:false,elem:that.config["$show_warn"+index]});that.config["$risk_pwd"+index].data("capsLock",true)}else if(that.config["$risk_pwd"+
index].data("capsLock")){that.ui.focuswarn({result:true,elem:that.config["$show_warn"+index]});that.config["$risk_pwd"+index].data("capsLock",false)}else if(that.config["$risk_pwd"+index].data("iswarn")){that.config["$risk_pwd"+index].data("iswarn",false);that.ev.delayhide(index)}});that.config["$risk_pwd"+index].keyup(function(){if(that.ev.cansubmit())that.ui.submitType(1);else that.ui.submitType(0)});that.config["$risk_pwd"+index].keydown(function(e){e.stopPropagation()})})(i,$(v))});that.config["$risk_pwd1"].keyup(function(e){var val=
$(this).val();var result=that.ev.checkpwd_1(val);that.ui.degree(result.degree);var code=e.keyCode;if(code==13)that.config["$risk_pwd2"].focus()});that.config["$risk_pwd2"].keyup(function(e){var code=e.keyCode;if(code==13)that.config.$submit.trigger("click")})},submitSuccess:function(){var time=3;that.config.$second.html(time);that.ui.submitType(3);that.config["$risk_pwd2"].off("keyup");$(document).off("keydown keypress").on("keypress",function(e){var code=e.keyCode;if(code==13)that.config.$iknow.trigger("click")});
that.config.interval.countdown=setInterval(function(){time=--time>0?time:0;if(!time){clearInterval(that.config.interval.countdown);that.ui.dialogClose()}that.config.$second.html(time)},1E3)},submitFail:function(){var time=3;that.config.$second.html(time);that.ui.submitType(4);that.config.interval.countdown=setInterval(function(){time=--time>0?time:0;if(!time){clearInterval(that.config.interval.countdown);that.ui.dialogClose()}that.config.$second.html(time)},1E3)},submit:function(){that.config.$submit.on("click",
function(){var cansubmit=$(this).data("cansubmit");if(cansubmit){var pwd1=that.config.$risk_pwd1.val();var pwd2=that.config.$risk_pwd2.val();that.ui.submitType(2);that.data.resetpwd(pwd1,pwd2).done(function(rtn){if(rtn.code==0)that.ev.submitSuccess();else that.ev.submitFail()}).fail(function(){that.ev.submitFail()})}})}};that.data={resetpwd:function(pwd1,pwd2){return $.ajax({type:"post",url:"https://passport.vip.com/reset_password",dataType:"json",cache:false,data:{password:pwd1,confirm:pwd2}})}};
that.ev.init()}$(function(){if(window.PhoneBind&&/login/.test(window.location.href))window.phoneBind=new PhoneBind({phoneNum:"",isBg:true,haveTip:true,show:false,success:function(phone){redirect2Src()},cancel:function(){redirect2Src()}})});
function bindPhoneIfDemand(){if(typeof PhoneBind=="undefined")redirect2Src();else $.ajax({type:"get",url:"//myi.vip.com/jsonp/api/phone/phone_safe_number?callback=?",dataType:"json",cache:false,crossDomain:true,success:function(result){if(result.code==200&&!result.data)try{phoneBind.show()}catch(e){redirect2Src()}else redirect2Src()},error:function(jqXHR,textStatus,errorThrown){redirect2Src()}})}
function redirect2Src(){if($.messenger&&$.messenger.send)$.messenger.send("method=loginSuccess");else{var redirectURLObj=$("#redirectURL");var src=redirectURLObj.length>0?redirectURLObj.val()?redirectURLObj.val():VIPSHOP.cookie.get("vipshop_passport_src"):VIPSHOP.cookie.get("vipshop_passport_src");window.location=src}}var ajaxSending=0;
function sendAjax(url,data,successcallback,async,errorcallback){if(arguments.length<1)alert("url is needed");if(url.indexOf("?")!=-1)url=url+"&callback=?";else url=url+"?callback=?";if(!data)data={};if(!async)async=true;if(ajaxSending>0)return;ajaxSending++;$.ajax({type:"POST",url:url,data:data,async:async,success:function(result){ajaxSending=0;if(typeof data.result!="undefined"&&data.result=="haslogin"){if(clsoseMessenger())return false;redirect2Src();return}if(!successcallback){eval(successcallback+
"(result)");return}},error:function(jqXHR,textStatus,errorThrown){if(!errorcallback){eval(errorcallback);return}}})}
(function(){var CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(len,radix){var chars=CHARS,uuid=[],i;radix=radix||chars.length;if(len)for(i=0;i<len;i++)uuid[i]=chars[0|Math.random()*radix];else{var r;uuid[8]=uuid[13]=uuid[18]=uuid[23]="";uuid[14]="4";for(i=0;i<36;i++)if(!uuid[i]){r=0|Math.random()*16;uuid[i]=chars[i==19?r&3|8:r]}}return uuid.join("")};Math.uuidFast=function(){var chars=CHARS,uuid=new Array(36),rnd=0,r;for(var i=0;i<36;i++)if(i==
8||i==13||i==18||i==23)uuid[i]="-";else if(i==14)uuid[i]="4";else{if(rnd<=2)rnd=33554432+Math.random()*16777216|0;r=rnd&15;rnd=rnd>>4;uuid[i]=chars[i==19?r&3|8:r]}return uuid.join("")};Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})}})();
(function($){$.fn.btnLoading=function(flag){var $body=$("body"),$this=$(this),$loading=$("<div class='btnLoading'></div>");if(flag=="on"){if($body.find(".btnLoading").length){$body.find(".btnLoading").remove();$body.find("[data-act='btnLoading']").removeClass("on").removeAttr("data-act")}$loading.appendTo("body").css({"top":$this.offset().top+"px","left":$this.offset().left+"px"});$this.addClass("on").attr("data-act","btnLoading")}else{$body.find(".btnLoading").remove();$body.find("[data-act='btnLoading']").removeClass("on").removeAttr("data-act")}};
$.fn.errorMsg=function(msg,disableRed){var $this=$(this),interval,isRed=0,toggle=function(ele){if(isRed%2!==0)ele.removeClass("error");else ele.addClass("error");if(isRed===4)clearInterval(interval)};if($this.closest("p.inputs").length){var $parent=$this.closest("p.inputs");if($parent.next("p.labels").length){var $label=$parent.next("p.labels");interval=setInterval(function(){if(isRed===0)$label.html("<span class='dred'>"+msg+"</span>");if(!disableRed)toggle($this);isRed++},100)}}};$.fn.tipMsg=function(msg){var $this=
$(this),tips,toggle=function(ele){if(isRed%2!==0)ele.removeClass("error");else ele.addClass("error")};if($this.closest("p.inputs").length){var $parent=$this.closest("p.inputs");if($parent.next("p.labels").length)var $label=$parent.next("p.labels")}$(".auth-tips").addClass("z-hide");tips=$('[for="tips_'+$this.attr("id")+'"]');if(tips.length>0)if(tips.attr("data-direction")&&tips.attr("data-direction")=="top")tips.removeClass("z-hide").css({"top":$this.offset().top-tips.outerHeight()+1+"px","left":$this.offset().left+
"px","width":$this.outerWidth()-20});else tips.removeClass("z-hide").css({"top":$this.offset().top+"px","left":$this.offset().left+280+"px"})};$.fn.verified=function(){var $this=$(this);$this.addClass("verified").removeClass("error");if($this.closest("p.inputs").length){var $parent=$this.closest("p.inputs");if($parent.next("p.labels").length){var $label=$parent.next("p.labels");$label.text("")}}};$.fn.iptReset=function(msg){var $this=$(this);$this.removeClass("verified").removeClass("error");if($this.closest("p.inputs").length){var $parent=
$this.closest("p.inputs");if($parent.next("p.labels").length){var $label=$parent.next("p.labels");$label.text("")}}}})(jQuery);
function changeCode(type){if(type===0)changeCodeV2();else{var imgId=$("#verify_image1");var vipc=$("#user_reg_form").find(':input[name="vipc"]').val();imgId.one("error",function(){$("#J_L_code").errorMsg("\u7cfb\u7edf\u5f02\u5e38\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u518d\u8bd5\u3002")});imgId.attr("src",ctx+"/captcha/getCaptcha?type="+type+"&vipc="+encodeURIComponent(vipc)+"&v="+(new Date).getTime())}}
var PassportUtil=function(){var base64=true;var image=document.createElement("img");image.onload=image.onerror=function(){base64=image.width===1};image.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";return{supportBase64:function(){return base64}}}();
function changeCodeV2(){var imgNode=$("#verify_image"),questionImg=$("#J_frame_que_img_wrap"),vipc=$("#J_L_vipc").val(),verifyCode=$("#login_code_li .verifyCode"),src=ctx+"/captcha/V2/getCaptcha?type=0&vipc="+encodeURIComponent(vipc)+"&v="+(new Date).getTime();verifyCode.removeClass("f-error").addClass("f-loading");if(!PassportUtil.supportBase64()){imgNode.attr("src",ctx+"/captcha/V2/getICaptcha?type=0&vipc="+encodeURIComponent(vipc)+"&v="+(new Date).getTime()).on("load",function(){verifyCode.removeClass("f-loading")}).on("error",
function(){verifyCode.addClass("f-error").removeClass("f-loading")});return false}$.ajax({type:"GET",url:src,dataType:"json",success:function(rtn){if(rtn.success){var bizObj=rtn.bizObj||{};var captchaType=bizObj.captchaType;var pic=bizObj.pic;switch(captchaType){case 1:pic="data:image/png;base64,"+pic;questionImg.addClass("f-hidden");imgNode.attr("src",pic);break;case 6:var imgs={};try{imgs=$.parseJSON(pic)}catch(e){VIPSHOP.log("Init question captcha error: ",e)}if(imgs.qp&&imgs.ap){var qImg="data:image/png;base64,"+
imgs.qp;var aImg="data:image/png;base64,"+imgs.ap;questionImg.removeClass("f-hidden");var jqQImg=questionImg.find("#J_que_img");jqQImg.attr("src",qImg);imgNode.attr("src",aImg)}else verifyCode.addClass("f-error");break;default:verifyCode.addClass("f-error")}}resizeIframe()},error:function(){verifyCode.addClass("f-error")},complete:function(){verifyCode.removeClass("f-loading")}})}function format_name(name){return name.replace(/\s/g,"")}
function check_reg_name($input){$input.iptReset();var check_result=checkRegisterUserName($input.val());if(!check_result.result)$input.errorMsg(check_result.tips);else $input.verified();return check_result.result}
function check_reg_pwd($input,type){$input.iptReset();if(1==type){var pwd=$("#J_R_psw").val();if($input.val()!=pwd){$input.errorMsg("\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u4e00\u81f4");return false}$input.verified();return true}var check_result=checkPassword($input.val());if(!check_result.result)$input.errorMsg(check_result.tips);else $input.verified();return check_result.result}
function check_captcha($captcha,$vipc,type){$captcha.iptReset();if(!$captcha.val()||!$vipc.val()){$captcha.errorMsg("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801");return false}var check_result=checkCaptcha($captcha.val(),$vipc.val(),type);if(!check_result.result){$captcha.errorMsg(check_result.tips);if(check_result.vipc)$vipc.val(check_result.vipc);changeCode(type)}else $captcha.verified();return check_result.result}
function check_agreed($input){if("1"!=$input.val()){$input.errorMsg("\u63a5\u53d7\u670d\u52a1\u6761\u6b3e\u624d\u80fd\u6ce8\u518c");return false}return true}function check_pv(name){if(checkPhone(name)){if(!window.pv.ssid){pv.showError(1);return false}var inputVC=window.pv.getVerifyCode();if(!inputVC||inputVC=="\u77ed\u4fe1\u9a8c\u8bc1\u7801"){pv.showError(2);return false}}return true}
function show_error(errorMsg){if(!errorMsg)return false;if(!errorMsg["type"])return false;var errorStatus=errorMsg["status"];var loginError;if(errorMsg["type"]==1){loginError={0:["J_L_code",2,"\u9a8c\u8bc1\u7801\u6709\u8bef"],1:["J_L_name",0,"\u767b\u5f55\u540d\u548c\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a"],2:["J_L_name",0,"\u767b\u5f55\u540d\u6709\u8bef"],3:["J_L_psw",0,'\u767b\u5f55\u540d\u6216\u5bc6\u7801\u9519\u8bef<a href="'+ctx+'/register" class="wrong_link" title="\u514d\u8d39\u6ce8\u518c" target="_blank">\u514d\u8d39\u6ce8\u518c</a>\u6216<a href="https://safe.vip.com/login/findPW/page" class="wrong_link" title="\u627e\u56de\u5bc6\u7801" target="_blank">\u627e\u56de\u5bc6\u7801</a>?',
true],4:["J_L_psw",1,'\u767b\u5f55\u540d\u6216\u5bc6\u7801\u9519\u8bef<a href="'+ctx+'/register" class="wrong_link" title="\u514d\u8d39\u6ce8\u518c" target="_blank">\u514d\u8d39\u6ce8\u518c</a>\u6216<a href="https://safe.vip.com/login/findPW/page" class="wrong_link" title="\u627e\u56de\u5bc6\u7801" target="_blank">\u627e\u56de\u5bc6\u7801</a>?',true],5:["J_L_name",0,"\u8d26\u6237\u5df2\u88ab\u51bb\u7ed3\uff0c\u8bf7\u8054\u7cfb\u5ba2\u670d"],6:["J_L_name",0,"\u60a8\u7684\u8d26\u6237\u53ef\u80fd\u5b58\u5728\u5f02\u5e38\uff0c\u672c\u6b21\u767b\u5f55\u5931\u8d25\u3002\u5982\u6709\u9700\u8981\uff0c\u8bf7\u8054\u7cfb\u5ba2\u670d\uff1a400-6789-888"],
17:["J_L_name",0,"\u767b\u5f55\u5931\u8d25\uff0c\u8bf7\u660e\u65e5\u518d\u8bd5\u6216\u8054\u7cfb\u5ba2\u670d"],19:["J_L_name",0,"\u60a8\u767b\u5f55\u7684\u8d26\u53f7\u5df2\u7ecf\u6ce8\u9500"]};if(errorStatus==6){alert(loginError[errorStatus][2]);return true}if(errorStatus==1||errorStatus==3||errorStatus==4)len=1;var redirectUrl=errorMsg["redirectUrl"];if(errorStatus==16&&redirectUrl&&redirectUrl!=""){var left=($(window).width()-400)/2,top=($(window).height()-246)/2;var tpl=$.Tpl("J_loginChallenge_tpl");
var dialog=$.Dialog({node:"#J_dialog",custom:true,customStyle:true,size:[400,246],position:[top,left],content:tpl});dialog.open();$(".u-loginChallenge-btn").on("click",function(){parent.location.href=redirectUrl});var times=3;var callself=function(){$(".u-left-time").html(times);if(times!==0){times--;setTimeout(callself,1E3)}else parent.location.href=redirectUrl};callself();return false}}else{loginError={0:["J_R_code",2,"\u9a8c\u8bc1\u7801\u6709\u8bef"],1:["saveagree",3,"\u63a5\u53d7\u670d\u52a1\u6761\u6b3e\u624d\u80fd\u6ce8\u518c"],
2:["J_R_name",0,"\u767b\u5f55\u540d\u4e0d\u80fd\u4e3a\u7a7a"],3:["J_R_name",0,"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\u6216\u90ae\u7bb1"],4:["gender",4,"\u8bf7\u9009\u62e9\u6027\u522b"],5:["J_R_psw",1,"\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a"],6:["J_R_psw",1,"\u5bc6\u7801\u6709\u8bef"],7:["J_R_psw",1,"\u4e0d\u80fd\u5168\u4e3a\u6570\u5b57\uff0c\u8bf7\u4f7f\u7528\u5b57\u6bcd\u548c\u6570\u5b57\u7ec4\u5408"],8:["J_R_psw",1,"\u4e0d\u80fd\u5168\u4e3a\u5b57\u6bcd\uff0c\u8bf7\u4f7f\u7528\u5b57\u6bcd\u548c\u6570\u5b57\u7ec4\u5408"],
9:["J_R_name",0,"\u767b\u5f55\u540d\u5df2\u5b58\u5728"],10:["J_R_name",0,"\u8bf7\u6c42\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u8bd5"],11:["J_R_name",0,"\u5df2\u8d85\u8fc7\u6ce8\u518c\u9650\u5236\uff0c\u8bf7\u7a0d\u7b49\u7247\u523b"]};if(errorStatus==1||errorStatus==3||errorStatus==8)len=1}if(!loginError[errorStatus])return false;$input=jQuery("#"+loginError[errorStatus][0]);$input.errorMsg(loginError[errorStatus][2],loginError[errorStatus][3]);return true}
function check_login_name($input){$input.iptReset();if(!$input.val()){$input.errorMsg("\u8bf7\u8f93\u5165\u767b\u5f55\u540d");return false}var _val=format_name($input.val());$input.val(_val);if(!checkQQ(_val)){$input.errorMsg("\u767b\u5f55\u540d\u6709\u8bef");return false}return true}function check_login_pwd($input){$input.iptReset();if(!$input.val()){$input.errorMsg("\u8bf7\u8f93\u5165\u5bc6\u7801");return false}return true}
function getQueryStringByName(name){var result=location.search.match(new RegExp("[?&]"+name+"=([^&]+)","i"));if(result==null||result.length<1)return"";return result[1]};
